{% extends "base.j2" %}

{% block main %}
    <div class="hpanel">
        <div class="panel-body">
            <h2 class="font-light m-b-xs">
                Search series
            </h2>

            <form id="search-form" cclass="col-lg-offset-1" style="margin-top: 1em">
                <div class="input-group">
                    <input type="text" class="form-control input-lg" name="q" value="{{ request.GET.q or '' }}" placeholder="Type in keywords">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-primary btn-lg">Search</button>
                    </span>
                </div>
                {% if tags %}
                    <div class="input-group" style="margin-top: 1em">
                        <label class="control-label" style="padding-left: 0; font-weight: bold">Exclude:</label> &nbsp;
                        {% for tag in tags|sort %}
                        <label class="checkbox-inline">
                            <input type="checkbox" name="exclude_tags" value="{{ tag }}"
                                {%- if tag in request.GET.getlist('exclude_tags') %} checked{% endif -%}
                            >{{ tag }}
                        </label>
                        {% endfor %}
                    </div>
                {% endif %}
            </form>
            <script>
                $('#search-form input[name=q]').focus();
                $('#search-form [name=exclude_tags]').on('click', function () {
                    $('#search-form').submit();
                })
            </script>
        </div>
    </div>

{% if series %}

<div class="hpanel forum-box">
    {% if page and page is not none %}
    <div class="panel-heading">
        {{ page.paginator.count }} serie{{ page.paginator.count|pluralize }} found,
        {{ page.start_index() }}&ndash;{{ page.end_index() }} shown.
    </div>
    {% endif %}

    {% for serie in series %}
    <div class="panel-body search-result">
        <div class="row">
            <div class="col-md-1 forum-info" style="width: 4.5em">
                <a class="btn btn-success btn-sm" href="{{ url('annotate') }}?series_id={{ serie.series_id }}">Tag</a>
            </div>
            <div class="col-md-10 forum-heading">
                <h4>{{ serie.series_title }}</h4>
                <div class="desc">{{ serie.series_summary|truncate(300, True) }}</div>
                <p style="margin: 0.5em 0 0">
                    Serie: {{ serie.gse_name }},
                    {% with platforms = serie.series_platform_id.split('---') %}
                        Platform{{ platforms|count|pluralize }}: {{ platforms|join(', ') }}
                    {%- endwith -%}
                    {%- if serie_tags[serie.series_id] -%}
                        , Tags done:
                        {%- for tag in serie_tags[serie.series_id] %}
                        <span class="label label-success">{{ tag }}</span>
                        {% endfor %}
                    {% endif %}
                </p>
            </div>
            <div class="col-md-1 forum-info">
                <span class="number">{{ serie.series_sample_id.split()|count }}</span>
                <small>Samples</small>
            </div>
        </div>
    </div>
    {% endfor %}

    {% if page and page.has_other_pages() %}
    <div class="panel-footer">
        <div class="btn-group">
            {% if page.has_previous() %}
                <a href="/search/?q={{ request.GET.q }}&amp;p={{ page.previous_page_number() }}" class="btn btn-default">
                    <i class="fa fa-chevron-left"></i>
                </a>
            {% endif %}

            {% for p in page.paginator.page_range %}
                <a href="/search/?q={{ request.GET.q }}&amp;p={{ p }}" class="btn btn-default{% if p == page.number %} active{% endif %}">{{ p }}</a>
            {% endfor %}

            {% if page.has_next() %}
              <a href="/search/?q={{ request.GET.q }}&amp;p={{ page.next_page_number() }}" class="btn btn-default">
                <i class="fa fa-chevron-right"></i>
              </a>
            </li>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>


{% endif %}


{#  {% if series %}
<div class="table-responsive" sstyle="margin-top: 1em">
  <table class="table table-striped table-bordered" id="data-table">
    <thead>
      <tr>
        <th></th>
        {% for col in columns %}
          <th class="col-{{ col }}">{{ col }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for serie in series %}
      <tr>
        <td><a class="btn btn-primary btn-sm" href="{{ url('annotate') }}?series_id={{ serie.series_id }}">Tag</a></td>
        {% for col in columns %}
          <td class="col-{{ col }}">{{ serie[col]|string|truncate(70, True) }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
 #}



 {% endblock %}

