{% extends "base.j2" %}

{% block content %}
<h2 class="sub-header">Tagging {{ serie.gse_name }}</h2>

<form class="form-inline well" id="tag-form">
  <div class="form-group">
    <label for="tag">Tag</label>
    <select name="tag" class="form-control" id="tag">
      <option value="">...</option>
      {% for tag in tags %}
          <option value="{{ tag.id }}">{{ tag.tag_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <label for="column">Column</label>
    <select name="column" class="form-control" id="column">
      <option value="">all</option>
      {% for col in columns %}
        {% if col != 'sample_id' %}
          <option value="{{ col }}">{{ col }}</option>
        {% endif %}
      {% endfor %}
    </select>
  </div>
  <div id="regex-form-group" class="form-group">
    <label for="regex" class="control-label">Regex</label>
    <input type="text" name="regex" class="form-control" id="regex">
  </div>
  <button type="button" class="btn btn-default">Save</button>
  <span id='my-re'></span>
</form>

<ul id="facets" class="nav nav-tabs">
  <li role="presentation" class="active"><a href="#"><b>All</b> ({{ samples|count }})</a></li>
</ul>

<div class="table-responsive">
  <table class="table table-striped table-bordered" id="data-table">
    <thead>
      <tr>
        <th>Tag Value</th>
        {% for col in columns %}
          <th class="col-{{ col }} selectable">{{ col }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      <!-- Generated by js -->
    </tbody>
  </table>
</div>

<style type="text/css">
.nav-tabs .glyphicon {top: 2px;}
#data-table {width: auto}
#data-table th.selectable {cursor: pointer; text-decoration: underline;}
#data-table tr.fixed {background-color: #D6EDFF}
#data-table mark {padding: 0;}
#data-table mark:first-child {background-color: yellow}
#data-table mark.bg-danger {background-color: #ff9070}
#data-table input {width: 10em;}
</style>

<script>
var tags = {{ tags|json|safe }};
var columns = {{ columns|json|safe }};
var samples = {{ samples|json|safe }};

var tagNames = _.object(tags.map(function (tag) {
  return [tag.id, tag.tag_name]
}));
</script>
<script type="text/javascript" src="{{ static('annotate.js') }}"></script>
{% endblock %}
